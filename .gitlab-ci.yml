stages:
  - prepare
  - build
  - publish

before_script:
  - echo 'export const licence = `dummy`' > example/src/licence.js

# -- Prepare ---

install npm dependencies:
  image: $CI_REGISTRY/gomibo-group/verifai-mobile-sdk/react-native-sdk:node-0.2
  stage: prepare
  artifacts:
    expire_in: 8 hours
    paths:
      - node_modules
      - example/node_modules
  script:
    - yarn


# --- Build ---

android build sdk:
  image: $CI_REGISTRY/gomibo-group/verifai-mobile-sdk/react-native-sdk:android-0.2
  stage: build
  dependencies:
    - install npm dependencies
  artifacts:
    expire_in: 8 hours
    paths:
      - example/android/app/build/outputs/apk/release
  script:
    - cd example/android
    - ./gradlew app:build


# --- Publish --- #

publish to npm:
  image: $CI_REGISTRY/gomibo-group/verifai-mobile-sdk/react-native-sdk:node-0.1
  stage: publish
  dependencies:
    - install npm dependencies
  only:
    - /^v(\d+\.){2}(\d+)$/
  when: manual
  script:
    - npm version --no-git-tag-version from-git
    - npm set //registry.npmjs.org/:_authToken=$NPM_RELEASE_TOKEN
    - npm publish --access public
